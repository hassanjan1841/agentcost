# .gitignore Configuration Guide

## Overview
The `.gitignore` file in this monorepo project is configured to exclude all unnecessary files while preserving essential source code, configuration, and documentation.

## Structure

### 1. Dependencies & Package Managers
```
node_modules/
pnpm-lock.yaml
yarn.lock
package-lock.json
```
**Why:** Lock files vary per environment. Dependencies are reinstalled via `pnpm install`.

### 2. Build & Output Directories
```
dist/
build/
apps/dashboard/.next/
packages/sdk/dist/
*.tsbuildinfo
```
**Why:** Generated during build process. Should be rebuilt in each environment.

### 3. Environment Variables (CRITICAL)
```
.env
.env.local
.env.production
.env.*.local
```
**Why:** Contains sensitive information:
- Database credentials
- API keys
- Secrets
- Personal configurations

⚠️ **NEVER commit `.env` files!**

### 4. IDE & Editor Files
```
.vscode/
.idea/
*.swp
*.swo
```
**Why:** Personal editor configurations shouldn't affect team members.

### 5. OS & System Files
```
.DS_Store (macOS)
Thumbs.db (Windows)
.cache/ (Linux)
```
**Why:** Automatically generated by operating systems. Not relevant to code.

### 6. Testing & Coverage
```
coverage/
.nyc_output/
.pytest_cache/
```
**Why:** Generated during test runs. Should be regenerated locally.

### 7. Logs
```
*.log
npm-debug.log*
pnpm-debug.log*
```
**Why:** Runtime logs are environment-specific and not part of source code.

### 8. Temporary Files
```
*.tmp
*.bak
*.swp
*~
```
**Why:** Temporary editor/system files.

## What Should Be Committed

### ✅ Always Commit
- Source code (`.ts`, `.tsx`, `.js`, `.json`)
- Configuration files (`package.json`, `tsconfig.json`, `.eslintrc`)
- Documentation (`.md` files)
- Example configurations (`.example.env`)
- CI/CD workflows (`.github/workflows/`)
- License files

### ❌ Never Commit
- `.env` files with secrets
- `node_modules/` directory
- Build artifacts (`dist/`, `.next/`)
- IDE-specific settings (`.vscode/settings.json`)
- OS files (`.DS_Store`, `Thumbs.db`)
- Lock files if not needed (though `pnpm-lock.yaml` can be committed for reproducibility)

## Best Practices

### 1. Environment Variables Template
Create example files for reference:
```bash
# Create template
cp .env .env.example
# Edit .env.example to remove actual values
# Commit .env.example (without secrets)
git add .env.example
```

### 2. Local-Only Configurations
For local development overrides:
```bash
# Use .env.local (ignored by git)
# Team uses .env.example or CONTRIBUTING.md
```

### 3. Verify Before Committing
```bash
# Check what will be committed
git status

# Check if sensitive files are staged
git diff --cached --name-only | grep -E "\.env|node_modules"

# Verify gitignore is working
git check-ignore -v <filename>
```

### 4. If You Accidentally Committed Secrets

⚠️ **Immediate Action Required:**

```bash
# Remove from history (DANGEROUS - affects all developers)
git rm --cached .env
git commit -m "Remove .env from tracking"

# OR: Use git-filter-repo (safer)
git filter-repo --path .env --invert-paths

# Rotate all exposed credentials immediately!
```

## Monorepo-Specific Patterns

### Root Level
- `node_modules/` - All workspace dependencies
- `.turbo/` - Turbo build cache

### Per-Package Level
```
packages/sdk/
  ├── dist/        ← Ignored
  ├── build/       ← Ignored
  └── node_modules/ ← Ignored (linked from root)

apps/dashboard/
  ├── .next/       ← Ignored
  ├── dist/        ← Ignored
  └── node_modules/ ← Ignored (linked from root)
```

## Development Setup

### For New Team Members
```bash
# Clone repo
git clone <repo-url>
cd agentcost

# Setup environments
cp .env.example .env.local
# Edit .env.local with local values

# Install & build
pnpm install
pnpm dev
```

### For CI/CD
```bash
# CI automatically uses provided secrets
# No .env file needed in CI environment
# Secrets passed via GitHub Secrets / environment variables
```

## File-Specific Rules

### Database Files
```
*.db
*.sqlite
*.sqlite3
```
**Why:** Local database instances. Each developer has their own.

### Generated Documentation
```
docs/_build/
docs/site/
```
**Why:** Built from source. Regenerated during CI/CD.

### Cache Files
```
.eslintcache
.prettierignore
pnpm-store/
```
**Why:** Optimization caches. Regenerated automatically.

## Verifying .gitignore Works

```bash
# Test if a file is ignored
git check-ignore -v packages/sdk/dist/index.js

# List all ignored files
git status --ignored

# Force-add an ignored file (if needed)
git add -f filename

# Remove tracked file that should be ignored
git rm --cached filename
git add .gitignore
git commit -m "Remove file from tracking"
```

## Common Mistakes

### ❌ Mistake 1: Committing .env
```bash
# Wrong
git add .env
git commit -m "Add env config"

# Right
git add .env.example  # Template only
# Add actual .env to .gitignore
```

### ❌ Mistake 2: Committing node_modules
Usually happens when:
- `.gitignore` is incomplete
- Accidentally forced with `git add -f node_modules/`

**Solution:**
```bash
git rm -r --cached node_modules/
git commit -m "Remove node_modules from tracking"
```

### ❌ Mistake 3: Committing IDE files
```bash
# Wrong
git add .vscode/settings.json

# Right
# Keep personal .vscode/ in .gitignore
# Share defaults via .vscode/settings.example.json
git add .vscode/settings.example.json
```

## Updating .gitignore

When adding new ignores:
```bash
# Edit .gitignore
nano .gitignore  # Add new patterns

# Commit the change
git add .gitignore
git commit -m "Update .gitignore for new pattern"

# If files already tracked, remove them
git rm --cached <file>
git commit -m "Stop tracking <file>"
```

## Reference Links
- [Git Documentation](https://git-scm.com/docs/gitignore)
- [GitHub .gitignore Templates](https://github.com/github/gitignore)
- [Git Secrets Detection](https://github.com/gitleaks/gitleaks)
